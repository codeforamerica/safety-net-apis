# Work in progress: Income Item schema using discriminator-based inheritance
# IncomeItem is the polymorphic type for REST endpoints; concrete types inherit via allOf
# Enums are not intended as final values, but examples at this point.

VerificationSource:
  description: A source of verification, which may be an external API or document.
  properties:
    id:
      type: string
      format: uuid
      description: Unique identifier for the verification source.
      readOnly: true

IncomeItem:
  type: object
  description: A single income item. Use the 'type' field to determine the specific income type and available properties.
  required:
    - personId
    - type
    - amount
    - frequency
    - reportedOn
    - source
    - startDate
  discriminator:
    propertyName: type
    mapping:
      employed: '#/EmployedEarnedIncomeItem'
      self_employed: '#/SelfEmployedEarnedIncomeItem'
      unearned: '#/UnearnedIncomeItem'
  properties:
    id:
      type: string
      format: uuid
      description: Unique identifier for the income item.
      readOnly: true
    personId:
      type: string
      format: uuid
      description: Foreign key reference to the person who has this income.
    type:
      type: string
      description: The type of income this item represents. Used as discriminator.
      enum:
        - employed
        - self_employed
        - unearned
    incomeBasis:
      type: string
      description: Whether the income is net or gross.
      enum:
        - net
        - gross
    amount:
      type: number
      format: float
      description: The amount of income this item represents.
    frequency:
      type: string
      description: The frequency with which the income is received.
      enum:
        - hourly
        - daily
        - weekly
        - every_2_weeks
        - twice_a_month
        - monthly
        - yearly
    reportedOn:
      type: string
      format: date
      description: The date the income was reported on.
    source:
      type: string
      description: The source of the income item.
      enum:
        - client
        - authorized_assister
        - county_worker
    startDate:
      pass
    endDate:
      pass
    isVerified:
      type: boolean
      description: Whether the income has been verified.
    verifiedDate:
      type: string
      format: date
      description: The date the income was verified.
    verifiedBy:
      type: string
      format: uuid
      description: The county worker who verified the income.
    verificationSourceIds:
        type: array
        description: "Array of verification sources related to this income."
        items:
          type: string
          format: uuid


EmployedEarnedIncomeItem:
  description: Income from employment.
  required:
    - employerId
    - seasonalOrTemporary
    - tipsOrCommission
    - didStrike
  allOf:
    - $ref: '#/IncomeItem'
    - type: object
      properties:
        employerId:
          type: string
          format: uuid
          description: The employer related to this earned income.
        averageHoursPerWeek:
          type: number
          format: float
          description: Average hours worked each week
          minimum: 0
          maximum: 168
        seasonalOrTemporary:
          pass
        tipsOrCommission:
          pass
        didStrike:
          pass

SelfEmployedEarnedIncomeItem:
  description: Income from self-employment.
  required:
    - employerId
    - typeOfSelfEmployment
  allOf:
    - $ref: '#/IncomeItem'
    - type: object
      properties:
        employerId:
          type: string
          format: uuid
          description: The employer related to this earned income.
        oneMonthsGrossIncome:
          type: number
          format: float
          description: One month's gross income
          minimum: 0
        typeOfSelfEmployment:
          type: array
          description: Type of self-employment
          items:
            type: string
            enum:
              - sole_proprietor
              - llc
              - s_corp
              - independent_contractor
        utilitiesPaidForBusiness:
          type: number
          format: float
          description: Utilities paid for business
          minimum: 0
        businessTaxesPaid:
          type: number
          format: float
          description: Business taxes paid
          minimum: 0
        interestPaidForBusiness:
          type: number
          format: float
          description: Interest paid for business
          minimum: 0
        grossBusinessLaborCosts:
          type: number
          format: float
          description: Gross business labor costs
          minimum: 0
        costOfMerchandise:
          type: number
          format: float
          description: Cost of merchandise
          minimum: 0
        otherBusinessCosts:
          type: array
          description: Other business costs
          items:
            type: object
            properties:
              type:
                type: string
                description: Type
                maxLength: 100
              amount:
                type: number
                format: float
                description: Cost amount
                minimum: 0
        totalNetIncome:
          type: number
          format: float
          description: Total Net Income (Subtract your expenses from your gross income)
          minimum: 0


UnearnedIncomeItem:
  description: Income from an unearned source.
  required:
    - typeOfUnearnedIncome
  allOf:
    - $ref: '#/IncomeItem'
    - type: object
      properties:
        typeOfUnearnedIncome:
          type: string
          enum:
            - unemployment
            - kinship_payment
            - veterans_programs
            - adoption_and_refugee_services
            - ssi_or_ssdi
            - private_disability
            - workers_compensation
            - disability_from_veterans_programs
            - legal_form_or_settlement
            - scholarship
            - educational_grant
            - work_study
            - spousal_support
            - child_support
            - retirement_or_pension_plan
            - investment_interest_and_dividends
            - social_security_retirement
            - renting_home
            - renting_room
            - renting_equipment
            - gambling_lottery_or_other_winnings
            - donations_or_gifts
            - income_from_loan_or_mortgage
            - payment_for_participating_in_research
            - other_money_not_reported


